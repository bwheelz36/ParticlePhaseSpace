<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Basic Example &mdash; Particle Phase Space  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Writing a new data loader" href="new_data_loader.html" />
    <link rel="prev" title="Examples" href="examples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Particle Phase Space
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Basic Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Data-import">Data import</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Calculation-of-additional-quantities">Calculation of additional quantities</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Reset-the-phase-space-to-required-columns">Reset the phase space to required columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Basic-analytics">Basic analytics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Seperating,-adding,-and-subtracting-phase-space-objects">Seperating, adding, and subtracting phase space objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Twiss-parameters">Twiss parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Exporting-the-data">Exporting the data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="new_data_loader.html">Writing a new data loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="IAEA.html">Reading IAEA phase space</a></li>
<li class="toctree-l2"><a class="reference internal" href="new_data_exporter.html">Writing a new data exporter</a></li>
<li class="toctree-l2"><a class="reference internal" href="transform.html">Transformation of phase space data</a></li>
<li class="toctree-l2"><a class="reference internal" href="units.html">Working with different units</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid_merge.html">Compress phase space via regrid/merge operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="resampling_via_gaussian_kde.html">Up/Down sampling phase space data using gaussian KDE</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="phase_space_format.html">Phase Space Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="supported_particles.html">Supported particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="limitations.html">Limitations</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_docs.html">Code Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Particle Phase Space</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="examples.html">Examples</a></li>
      <li class="breadcrumb-item active">Basic Example</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/basic_example.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Basic-Example">
<h1>Basic Example<a class="headerlink" href="#Basic-Example" title="Link to this heading"></a></h1>
<section id="Data-import">
<h2>Data import<a class="headerlink" href="#Data-import" title="Link to this heading"></a></h2>
<p>The first step of data analysis is import data. In this code, data import is always handled through an instance of the <a class="reference external" href="https://bwheelz36.github.io/ParticlePhaseSpace/code_docs.html#module-ParticlePhaseSpace.DataLoaders">DataLoaders</a> class. In this example, we will work with topas data. For a list of all currently available data importers, see <a class="reference external" href="https://bwheelz36.github.io/ParticlePhaseSpace/code_docs.html#module-ParticlePhaseSpace.DataLoaders">here</a>; for instructions on writing new data
importers see <a class="reference external" href="https://bwheelz36.github.io/ParticlePhaseSpace/new_data_loader.html">here</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">)</span>  <span class="c1"># not necessary when the library is installed</span>
<span class="kn">from</span> <span class="nn">ParticlePhaseSpace</span> <span class="kn">import</span> <span class="n">DataLoaders</span>
<span class="kn">from</span> <span class="nn">ParticlePhaseSpace</span> <span class="kn">import</span> <span class="n">PhaseSpace</span>

<span class="n">test_data_loc</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;../tests/test_data/coll_PhaseSpace_xAng_0.00_yAng_0.00_angular_error_0.0.phsp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
<span class="n">ps_data</span> <span class="o">=</span> <span class="n">DataLoaders</span><span class="o">.</span><span class="n">Load_TopasData</span><span class="p">(</span><span class="n">test_data_loc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Once we have a DataLoader instance, we can pass it to ParticlePhaseSpace for analysis:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span> <span class="o">=</span> <span class="n">PhaseSpace</span><span class="p">(</span><span class="n">ps_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The underlying data is stored in a pandas data frame at <code class="docutils literal notranslate"><span class="pre">ps_data</span></code>. You shouldn’t often have to (or want to) interact with this directly, but let’s take a quick look at the data so you know what it looks like:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span><span class="o">.</span><span class="n">ps_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>particle type [pdg_code]</th>
      <th>x [mm]</th>
      <th>y [mm]</th>
      <th>z [mm]</th>
      <th>weight</th>
      <th>particle id</th>
      <th>time [ps]</th>
      <th>px [MeV/c]</th>
      <th>py [MeV/c]</th>
      <th>pz [MeV/c]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>22</td>
      <td>-0.971177</td>
      <td>-0.817280</td>
      <td>396.0</td>
      <td>0.01</td>
      <td>0</td>
      <td>0</td>
      <td>-0.008856</td>
      <td>-0.010509</td>
      <td>-3.184060</td>
    </tr>
    <tr>
      <th>1</th>
      <td>22</td>
      <td>-0.916198</td>
      <td>0.839298</td>
      <td>396.0</td>
      <td>0.01</td>
      <td>1</td>
      <td>0</td>
      <td>-0.003894</td>
      <td>0.008249</td>
      <td>-1.560114</td>
    </tr>
    <tr>
      <th>2</th>
      <td>22</td>
      <td>-5.258902</td>
      <td>11.318420</td>
      <td>396.0</td>
      <td>0.01</td>
      <td>2</td>
      <td>0</td>
      <td>-0.193061</td>
      <td>0.377104</td>
      <td>-1.219742</td>
    </tr>
    <tr>
      <th>3</th>
      <td>22</td>
      <td>15.326971</td>
      <td>-25.628899</td>
      <td>396.0</td>
      <td>0.01</td>
      <td>3</td>
      <td>0</td>
      <td>0.102889</td>
      <td>-0.362594</td>
      <td>-1.414843</td>
    </tr>
    <tr>
      <th>4</th>
      <td>22</td>
      <td>-0.241948</td>
      <td>-0.401026</td>
      <td>396.0</td>
      <td>0.01</td>
      <td>4</td>
      <td>0</td>
      <td>-0.000192</td>
      <td>-0.001470</td>
      <td>-0.209232</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Calculation-of-additional-quantities">
<h2>Calculation of additional quantities<a class="headerlink" href="#Calculation-of-additional-quantities" title="Link to this heading"></a></h2>
<p>The data show here consists of the <a class="reference external" href="https://bwheelz36.github.io/ParticlePhaseSpace/phase_space_format.html#required-columns">required columns</a> - that is, the minimum data required to define a phase space. <a class="reference external" href="https://bwheelz36.github.io/ParticlePhaseSpace/phase_space_format.html#required-columns">Many other quantaties</a> can be calculated from this data using various <code class="docutils literal notranslate"><span class="pre">fill</span></code> methods. For example, to add in Kinetic Energy:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span><span class="o">.</span><span class="n">fill</span><span class="o">.</span><span class="n">kinetic_E</span><span class="p">()</span>
<span class="n">PS</span><span class="o">.</span><span class="n">ps_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>particle type [pdg_code]</th>
      <th>x [mm]</th>
      <th>y [mm]</th>
      <th>z [mm]</th>
      <th>weight</th>
      <th>particle id</th>
      <th>time [ps]</th>
      <th>px [MeV/c]</th>
      <th>py [MeV/c]</th>
      <th>pz [MeV/c]</th>
      <th>rest mass [MeV/c^2]</th>
      <th>p_abs [MeV/c]</th>
      <th>Ek [MeV]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>22</td>
      <td>-0.971177</td>
      <td>-0.817280</td>
      <td>396.0</td>
      <td>0.01</td>
      <td>0</td>
      <td>0</td>
      <td>-0.008856</td>
      <td>-0.010509</td>
      <td>-3.184060</td>
      <td>0.0</td>
      <td>3.184090</td>
      <td>3.184090</td>
    </tr>
    <tr>
      <th>1</th>
      <td>22</td>
      <td>-0.916198</td>
      <td>0.839298</td>
      <td>396.0</td>
      <td>0.01</td>
      <td>1</td>
      <td>0</td>
      <td>-0.003894</td>
      <td>0.008249</td>
      <td>-1.560114</td>
      <td>0.0</td>
      <td>1.560141</td>
      <td>1.560141</td>
    </tr>
    <tr>
      <th>2</th>
      <td>22</td>
      <td>-5.258902</td>
      <td>11.318420</td>
      <td>396.0</td>
      <td>0.01</td>
      <td>2</td>
      <td>0</td>
      <td>-0.193061</td>
      <td>0.377104</td>
      <td>-1.219742</td>
      <td>0.0</td>
      <td>1.291220</td>
      <td>1.291220</td>
    </tr>
    <tr>
      <th>3</th>
      <td>22</td>
      <td>15.326971</td>
      <td>-25.628899</td>
      <td>396.0</td>
      <td>0.01</td>
      <td>3</td>
      <td>0</td>
      <td>0.102889</td>
      <td>-0.362594</td>
      <td>-1.414843</td>
      <td>0.0</td>
      <td>1.464187</td>
      <td>1.464187</td>
    </tr>
    <tr>
      <th>4</th>
      <td>22</td>
      <td>-0.241948</td>
      <td>-0.401026</td>
      <td>396.0</td>
      <td>0.01</td>
      <td>4</td>
      <td>0</td>
      <td>-0.000192</td>
      <td>-0.001470</td>
      <td>-0.209232</td>
      <td>0.0</td>
      <td>0.209237</td>
      <td>0.209237</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Notice that while we only requested <code class="docutils literal notranslate"><span class="pre">Ek</span></code>, we also got rest mass and absolute momentum. This is because these quantities are required to calculate kinetic energy anyway. The code will always check whether a given quantity is already present in the data before recalculating it.</p>
<p>You can view all the available fill methods with this command:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span><span class="o">.</span><span class="n">fill</span><span class="o">.</span><span class="n">get_methods</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
absolute_momentum
beta_and_gamma
direction_cosines
kinetic_E
relativistic_mass
rest_mass
velocity
</pre></div></div>
</div>
<p>If you want to access any of the data inside this data frame, there are two ways: the unit specific way, and the unit agnostic way. The unit specific way is of course how would get data out of any DataFrame:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ek</span> <span class="o">=</span> <span class="n">PS</span><span class="o">.</span><span class="n">ps_data</span><span class="p">[</span><span class="s1">&#39;Ek [MeV]&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>You can also access the same quantities without reference to the units like this:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ek</span> <span class="o">=</span> <span class="n">PS</span><span class="o">.</span><span class="n">ps_data</span><span class="p">[</span><span class="n">PS</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="s1">&#39;Ek&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<p>Note that the second method will work regardless of what units the data is in.</p>
</section>
<section id="Reset-the-phase-space-to-required-columns">
<h2>Reset the phase space to required columns<a class="headerlink" href="#Reset-the-phase-space-to-required-columns" title="Link to this heading"></a></h2>
<p>In some situations, you may wish to remove all ‘derived’ quantities from the data, and have only the <a class="reference external" href="https://bwheelz36.github.io/ParticlePhaseSpace/phase_space_format.html#required-columns">required columns</a>. You may wish to do this to minimise the memory footpring, or because you have carried out some operation that potentially invalidated the calculated quantities (more on that below!) In such situations, you can use <code class="docutils literal notranslate"><span class="pre">reset_phase_space</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span><span class="o">.</span><span class="n">reset_phase_space</span><span class="p">()</span>
<span class="n">PS</span><span class="o">.</span><span class="n">ps_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>particle type [pdg_code]</th>
      <th>x [mm]</th>
      <th>y [mm]</th>
      <th>z [mm]</th>
      <th>weight</th>
      <th>particle id</th>
      <th>time [ps]</th>
      <th>px [MeV/c]</th>
      <th>py [MeV/c]</th>
      <th>pz [MeV/c]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>22</td>
      <td>-0.971177</td>
      <td>-0.817280</td>
      <td>396.0</td>
      <td>0.01</td>
      <td>0</td>
      <td>0</td>
      <td>-0.008856</td>
      <td>-0.010509</td>
      <td>-3.184060</td>
    </tr>
    <tr>
      <th>1</th>
      <td>22</td>
      <td>-0.916198</td>
      <td>0.839298</td>
      <td>396.0</td>
      <td>0.01</td>
      <td>1</td>
      <td>0</td>
      <td>-0.003894</td>
      <td>0.008249</td>
      <td>-1.560114</td>
    </tr>
    <tr>
      <th>2</th>
      <td>22</td>
      <td>-5.258902</td>
      <td>11.318420</td>
      <td>396.0</td>
      <td>0.01</td>
      <td>2</td>
      <td>0</td>
      <td>-0.193061</td>
      <td>0.377104</td>
      <td>-1.219742</td>
    </tr>
    <tr>
      <th>3</th>
      <td>22</td>
      <td>15.326971</td>
      <td>-25.628899</td>
      <td>396.0</td>
      <td>0.01</td>
      <td>3</td>
      <td>0</td>
      <td>0.102889</td>
      <td>-0.362594</td>
      <td>-1.414843</td>
    </tr>
    <tr>
      <th>4</th>
      <td>22</td>
      <td>-0.241948</td>
      <td>-0.401026</td>
      <td>396.0</td>
      <td>0.01</td>
      <td>4</td>
      <td>0</td>
      <td>-0.000192</td>
      <td>-0.001470</td>
      <td>-0.209232</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Basic-analytics">
<h2>Basic analytics<a class="headerlink" href="#Basic-analytics" title="Link to this heading"></a></h2>
<p>Once we have an instance of ParticlePhaseSpace, we can perform some analysis.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span><span class="o">.</span><span class="n">print_energy_stats</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
===================================================
                 ENERGY STATS
===================================================
total number of particles in phase space:  311489
number of unique particle species:  3
     308280 gammas
        mean energy:  1.91 MeV
        median energy:  1.20 MeV
        Energy spread IQR:  2.03 MeV
        min energy  0.01 MeV
        max energy  10.35 MeV
     2853 electrons
        mean energy:  3.16 MeV
        median energy:  3.39 MeV
        Energy spread IQR:  2.95 MeV
        min energy  0.02 MeV
        max energy  9.44 MeV
     356 positrons
        mean energy:  2.66 MeV
        median energy:  2.39 MeV
        Energy spread IQR:  2.39 MeV
        min energy  0.08 MeV
        max energy  8.46 MeV
</pre></div></div>
</div>
<p>You can see that this phase space consists of three different particle species. We can also generate plots for energy, and particle positions:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">energy_hist_1D</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/basic_example_20_0.png" src="_images/basic_example_20_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">position_hist_1D</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/basic_example_21_0.png" src="_images/basic_example_21_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">particle_positions_scatter_2D</span><span class="p">(</span><span class="n">beam_direction</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/basic_example_22_0.png" src="_images/basic_example_22_0.png" />
</div>
</div>
<p>Note that in the plot above, particles with different weights are plotted with different colors. Another way to visualise the particle positions is the <code class="docutils literal notranslate"><span class="pre">plot_beam_intensity</span></code> method, which will produce an image of accumulated intensity:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">particle_positions_hist_2D</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/basic_example_24_0.png" src="_images/basic_example_24_0.png" />
</div>
</div>
<p>This plot is actually a lot more illuminating than the scatter plot in this instance! This phase space was scored at the exit of a <a class="reference external" href="https://aapm.onlinelibrary.wiley.com/doi/10.1002/mp.15887">novel type of x-ray collimator</a>; you can see that the x-rays (gammas) have been shaped to a square, which is as expected. Meanwhile the electrons and positrons are randomly scattered, which is also as expected.</p>
<p>as with the <code class="docutils literal notranslate"><span class="pre">fill</span></code> methods, you can get all plotting methods like this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">get_methods</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
energy_hist_1D
momentum_hist_1D
n_particles_v_time
particle_positions_hist_2D
particle_positions_scatter_2D
position_hist_1D
transverse_trace_space_hist_2D
transverse_trace_space_scatter_2D
</pre></div></div>
</div>
</section>
<section id="Seperating,-adding,-and-subtracting-phase-space-objects">
<h2>Seperating, adding, and subtracting phase space objects<a class="headerlink" href="#Seperating,-adding,-and-subtracting-phase-space-objects" title="Link to this heading"></a></h2>
<p>You can easily add, subtract, and seperate phase space objects:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">electron_PS</span> <span class="o">=</span> <span class="n">PS</span><span class="p">(</span><span class="s1">&#39;electrons&#39;</span><span class="p">)</span>  <span class="c1"># this generates a phase space with only the electrons</span>
<span class="c1"># you can also use pdg codes:</span>
<span class="n">electron_PS</span> <span class="o">=</span> <span class="n">PS</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>  <span class="c1"># this is the same</span>
<span class="n">electron_PS</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">energy_hist_1D</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/basic_example_29_0.png" src="_images/basic_example_29_0.png" />
</div>
</div>
<p>You can also pass a list of particles to get multiple phase spaces at once:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gamma_PS</span><span class="p">,</span> <span class="n">positron_PS</span> <span class="o">=</span> <span class="n">PS</span><span class="p">([</span><span class="s1">&#39;gammas&#39;</span><span class="p">,</span> <span class="s1">&#39;positrons&#39;</span><span class="p">])</span>  <span class="c1"># you can also pass a list</span>
</pre></div>
</div>
</div>
<p>You can subtract one phase space from another. For example, the following will produce a new phase space object where all the gamma particles are removed:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">no_gamma_PS</span> <span class="o">=</span> <span class="n">PS</span> <span class="o">-</span> <span class="n">gamma_PS</span>
<span class="n">no_gamma_PS</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">energy_hist_1D</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/basic_example_33_0.png" src="_images/basic_example_33_0.png" />
</div>
</div>
<p>You can also add phase spaces together:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Original_PS</span> <span class="o">=</span> <span class="n">no_gamma_PS</span> <span class="o">+</span> <span class="n">gamma_PS</span>
<span class="n">Original_PS</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">energy_hist_1D</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/basic_example_35_0.png" src="_images/basic_example_35_0.png" />
</div>
</div>
<p>However: you cannot add identical particles into an existing phase space. If you really want to do this, you will need to update the particle_ID field first.</p>
</section>
<section id="Twiss-parameters">
<h2>Twiss parameters<a class="headerlink" href="#Twiss-parameters" title="Link to this heading"></a></h2>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Courant%E2%80%93Snyder_parameters">Twiss parameters</a> or courant-snyder parameters are commonly used to describe the distribution of particles in a transverse phase space. You can calculate, save, and plot the twiss parameters:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span><span class="o">.</span><span class="n">print_twiss_parameters</span><span class="p">(</span><span class="n">beam_direction</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>  <span class="c1"># calculate the RMS twiss parameters</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
===================================================
                 TWISS PARAMETERS
===================================================

gammas:
                x         y
epsilon  2.525901  2.673361
alpha    0.619585  0.525727
beta     8.976938  9.488084
gamma    0.154160  0.134526

electrons:
                x         y
epsilon  2.208669  2.357446
alpha    1.159332  1.009164
beta     4.971102  4.634599
gamma    0.471535  0.435510

positrons:
                x         y
epsilon  1.881200  1.178092
alpha    1.141023  2.283977
beta     3.888975  5.672388
gamma    0.591913  1.095932
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">transverse_trace_space_scatter_2D</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/basic_example_39_0.png" src="_images/basic_example_39_0.png" />
</div>
</div>
<p>The above plot shows what is sometimes called a ‘trace space’ which is plot of position (x) versus divergence (x’ = px/pz). The Red ellipse represents the space enclosed by the RMS twiss parameters, which should enclode 37% of the beam. As an alternative to the scatter plot, you can also visualise the intensity (defined as the sum of weights) in trace space:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">transverse_trace_space_hist_2D</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">plot_twiss_ellipse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/basic_example_41_0.png" src="_images/basic_example_41_0.png" />
</div>
</div>
<p>Again, this is quite illuminating; it shows that the gamma particles are fairly evenly distributed spread between -1 and 1 mm, have almost no divergence (note the highly intesense line in the middle, and the use og a log scale). Again, since this data is from an x-ray collimator, this makes a lot of sense!</p>
</section>
<section id="Exporting-the-data">
<h2>Exporting the data<a class="headerlink" href="#Exporting-the-data" title="Link to this heading"></a></h2>
<p>Similarly to the data import stage we use an instance of <code class="docutils literal notranslate"><span class="pre">ParticlePhaseSpace.DataLoaders</span></code> to export the data. You can see the currently available data exporters <a class="reference external" href="https://bwheelz36.github.io/ParticlePhaseSpace/code_docs.html#module-ParticlePhaseSpace.DataExporters">here</a>, and you see a demonstration of writing a new data exporter <a class="reference external" href="https://bwheelz36.github.io/ParticlePhaseSpace/new_data_exporter.html">here</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ParticlePhaseSpace</span> <span class="kn">import</span> <span class="n">DataExporters</span>

<span class="n">DataExporters</span><span class="o">.</span><span class="n">CSV_Exporter</span><span class="p">(</span><span class="n">PS</span><span class="p">,</span> <span class="n">output_location</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">),</span> <span class="n">output_name</span><span class="o">=</span><span class="s1">&#39;test_export&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;ParticlePhaseSpace.DataExporters.CSV_Exporter at 0x7f943666dca0&gt;
</pre></div></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="examples.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="new_data_loader.html" class="btn btn-neutral float-right" title="Writing a new data loader" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Brendan Whelan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>